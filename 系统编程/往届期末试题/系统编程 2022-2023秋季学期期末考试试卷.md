# 系统编程 2022-2023秋季学期期末考试试卷



## 选择题

1. 新建一个shell脚本文件 “cmd.sh” 后，往往不能直接执行它。如果想要通过“./cmd.sh”直接执行，一般需要什么操作 ___________________

   - [x] A. chmod +x cmd.sh

   - [ ] B. cd cmd.sh

   - [ ] C. touch cmd.sh

   - [ ] D. rm cmd.sh

2. 已知 x=1，以下 ___________________ 选项不能使 x 的值自增加一？

   - [ ] A. (( x ++ ))

   - [ ] B. x=$((x+1))

   - [ ] C. x=\`expr ${x} + 1\`

   - [ ] D. x=${x}+1

3. 以下 ___________________ 选项的Shell脚本能新建文件？

   - [ ] A. rm a.txt

   - [ ] B. touch --help

   - [ ] C. echo a > a

   - [ ] D. cd ~

4. 如果使用命令“gcc -c helloworld.c”编译“helloworld.c”文件，那么输出文件将是 ___________________

   - [ ] A. helloworld.o

   - [ ] B. helloworld.s

   - [ ] C. helloworld

   - [ ] D. a.out

5. 下列说法正确的是 ___________________

   - [ ] A. gcc是解释程序，将c代码解释为可执行程序。

   - [ ] B. gdb是调试程序，break指令用来终止调试。

   - [ ] C. shell脚本是一个文本文件，可用vim编辑器编辑保存。

   - [ ] D. make工具会根据Makefile的编写规则重新编译所有文件。

6. 对互斥锁及条件变量说法不正确的是 ___________________

   - [ ] A. 互斥锁保证让每个线程对共享资源按顺序进行原子操作。

   - [ ] B. 在使用条件变量时，互斥锁会失去作用，所以是否有互斥锁关系不重要。

   - [ ] C. 条件变量可以让多个线程在某一时间上保持同步。

   - [ ] D. 条件变量是让线程睡眠，在符合某种条件时唤醒睡眠的线程。

7. 下列选项 ___________________ 选项不是同一进程下的线程所能共享的?

   - [ ] A. 可执行程序文本

   - [ ] B. 寄存器值

   - [ ] C. 程序的全局内存

   - [ ] D. 文件描述符

8. 关于信号相关的函数，下列说法错误的是 ___________________

   - [ ] A. signal可以用于忽略一个信号。

   - [ ] B. sleep函数可以通过alarm和pause函数实现。

   - [ ] C. 在Linux系统中，调用alarm时，如果前一个闹钟时间未到，则会覆盖前一个时钟。

   - [ ] D. sigprocmask可以阻塞信号，信号被阻塞时不会丢失，在解除阻塞后再进行处理。

9. 若信号量的初始值为k，经过多次 P 和 V 操作后，信号量的值为-h(h>0)，则当前正在使用该资源的进程数（一个进程使用一个资源）和等待该资源的进程数分别是 ___________________

   - [ ] A. k+1, h

   - [ ] B. k, h

   - [ ] C. k, h+1

   - [ ] D. k, h-1

10. 以下关于共享内存的描述，正确的是 ___________________

    - [ ] A. 共享内存由于采用了内存操作的方式，所以速度较快，适合线程之间通信。

    - [ ] B. 共享内存必须要和信号量或其他机制协同使用，因为共享内存不提供对该内存在多进程间的保护。

    - [ ] C. 共享内存的数据传输需要经过内核。

    - [ ] D. mmap将普通文件内容映射到一段虚拟内存上，之后用户再通过调用read，write等函数对内存进行读写。

## 判断题

1. 每个进程都必须有一个PID，且必须属于某个进程组。
   - [ ] 正确
   - [ ] 错误
2. 在Shell中使用重定向后，会把重定向符号和文件名传递给所创建的进程。
   - [ ] 正确
   - [ ] 错误
3. 为了防止子进程变成僵尸进程，可以使用wait系统调用，但是使用wait系统调用无法获得子进程的返回状态。
   - [ ] 正确
   - [ ] 错误
4. 管道可以把前一个进程的标准输出和标准错误都传递给下一个进程。
   - [ ] 正确
   - [ ] 错误
5. 使用fork后，父子进程会共享fork前父进程所创建的管道。
   - [ ] 正确
   - [ ] 错误
6. 信号本质是软中断，用户可以捕捉所有的信号，并用signal等函数来自定义信号处理方式。
   - [ ] 正确
   - [ ] 错误
7. POSIX有名信号量可实现任意进程间通信，也可用于线程。
   - [ ] 正确
   - [ ] 错误
8. rmdir不能删除非空的目录，例如一个目录b中有main.c，rmdir b会执行失败。
   - [ ] 正确
   - [ ] 错误
9. Shell编程中，“echo \`echo 123\` | cat” 输出结果是 “echo 123”。
   - [ ] 正确
   - [ ] 错误
10. gcc -c main.c > log.txt能够让main.c在执行时将输出重定向到log.txt中。
    - [ ] 正确
    - [ ] 错误

## 简答题

1. 请各举一例说明Shell编程中环境变量、位置变量和内部变量（参考课件里的分类）的作用。

   

   ================================ 

   请在下面答题框里按以下格式答题：

   

   环境变量举例: xxxxxxxxx。

   环境变量作用总结: xxxxxxxxx。 

   

   位置变量举例: xxxxxxxxx。

   位置变量作用总结: xxxxxxxxx。

   

   内部变量举例: xxxxxxxxx。

   内部变量作用总结: xxxxxxxxx。

2. 进程和线程的作用分别是什么？试分析他们之间的关系。

   

   ================================ 

   请在下面答题框里按以下格式答题：

   

   （1）进程的作用是：xxxxxxxx。

   （2）线程的作用是：xxxxxxxx。

   （3）它们之间的关系：xxxxxxxx。

3. 同步和互斥的作用分别是什么？通过进程和线程间同步互斥工具的对比，分析两者之间的异同。

   

   ================================ 

   请在下面答题框里按以下格式答题：

   

   （1）同步的作用是：xxxxxxxx。

   （2）互斥的作用是：xxxxxxxx。

   （3）进程间同步常用的同步工具是：xxxxxxxx。

   （4）线程间同步常用的同步工具是：xxxxxxxx。

   （5）两类同步工具的异同分析：xxxxxxxx。

4. 文件描述符和目录项的作用分别是什么？试分析他们之间的关系。

   

   ================================ 

   请在下面答题框里按以下格式答题：

   

   （1）文件描述符的作用是：xxxxxxxx。

   （2）目录项的作用是：xxxxxxxx。

   （3）它们之间的关系分析：xxxxxxxx。

5. 通过举例至少三个场景说明信号的作用和用法。

   

   ================================ 

   请在下面答题框里按以下格式答题：

   

   举例（1）：信号的xxxxxxxx作用

      介绍一个用法实例。

   

   举例（2）：信号的xxxxxxxx作用

      介绍一个用法实例。

   

   举例（3）：信号的xxxxxxxx作用

      介绍一个用法实例。

## 程序分析题

1. 有以下一段C程序:

   \#include <stdio.h>

   \#include <unistd.h>

    

   1 int main()

   2 {

   3   int pid,i;

   4   pid=0;

   5   for(i=1;i<=3;i++){

   6    pid=fork();

   7    printf("%d\n",i);

   8   }

   9   if(pid>0){

   10    printf("ok\n");

   11  }

   12 }

   请问：

   （1）该程序总共会打印几行数字，其中数字1，2，3分别打印会几次（行）？

   （2）该程序会打印几行ok？请给出你的分析理由。

   ================================ 

   请在下面答题框里按以下格式答题：

   答（1）：  

   该程序总共会打印x行数字，其中数字1，2，3分别会打印 x，x，x 次（行）。

   理由是：xxxxxxx

   答（2）：  

   该程序会打印 x 行ok。

   理由是：xxxxxxx

2. 下列代码利用IO函数实现了Linux命令终端的复制（cp）命令。大概流程为使用 open() 打开源文件，使用 read() 从文件读数据，使用 write() 向目标文件写数据。试补全划线处的代码。

   \#include <stdio.h> 

   \#include <sys/types.h> 

   \#include <sys/stat.h> 

   \#include <fcntl.h> 

   int main(int argc, char *argv[]) 

   { 

     if((argc == 3) && (strcmp(argv[1], argv[2]) != 0)) 

   {  //保证有 3 个参数，而且源文件和目的文件名字不能一样 

   ​    int fd_src, fd_dest, ret; 

   ​    //只读方式打开源文件 

   ​          （1）        

   ​    if(fd_src < 0) 

   ​    { 

   ​      perror("open argv[1]"); 

   ​      return -1; 

   ​    } 

   ​    // 新建目的文件 

   ​          （2）        

   ​    if(fd_dest < 0) 

   ​    { 

   ​      close(fd_src); 

   ​      perror("open argv[2]"); 

   ​      return -1; 

   ​    }  

   ​    do 

   ​    { 

   ​      char buf[1024] = {0}; 

   ​      // 从源文件读取数据 

   ​            （3）        

    

   ​      // 把数据写到目的文件

   ​            （4）        

   ​    }while(ret > 0); 

   ​    // 关闭已打开的文件 

   ​    close(fd_src); 

   ​    close(fd_dest); 

     }  

     return 0; 

   } 

   ================================ 

   请在下面答题框里按以下格式答题：

   

   （1）你编写的语句1

   （2）你编写的语句2

   （3）你编写的语句3

   （4）你编写的语句4

3. 以下程序想要模拟1和2两个人交替吃饭，请问程序能否一定正常执行？如果不能，指出程序存在的问题。问题可能不止一处。

   1  #include <stdio.h>

   2  #include <stdlib.h>

   3  #include <pthread.h>

   4  #include <unistd.h>

   5  #include <string.h>

   6

   7  pthread_cond_t cond1, cond2;

   8  pthread_mutex_t mu;

   9

   10  void *eat1(void *args) {

   11      printf("1 eat\n");

   12      pthread_cond_signal(&cond2);

   13      while (1) {

   14         pthread_cond_wait(&cond1, &mu);

   15         printf("1 eat\n");

   16         pthread_cond_signal(&cond2);

   17      }

   18  }

   19

   20  void *eat2(void *args) {

   21      while (1) {

   22         pthread_cond_wait(&cond2, &mu);

   23         printf("2 eat\n");

   24         pthread_cond_signal(&cond1);

   25      }

   26  }

   27

   28  int main(void) {

   29      pthread_mutex_init(&mu, NULL);

   30      pthread_cond_init(&cond1, NULL);

   31      pthread_cond_init(&cond2, NULL);

   32      pthread_t t1, t2;

   33      pthread_create(&t1, NULL, eat1, NULL);

   34      pthread_create(&t2, NULL, eat2, NULL);

   35

   36      pthread_join(t1, NULL);

   37      pthread_join(t2, NULL);

   38  }

   

   ================================ 

   请在下面答题框里按以下格式答题：

   

   一定/不一定能正常执行。

   理由是：

   （1）xxxx。

   （2）xxxx。

    ……

